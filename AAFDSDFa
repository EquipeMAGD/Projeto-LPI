#include <stdio.h>
#include <stdlib.h>
#include <windows.h>
#include <conio.h>
#include <dos.h>

//
typedef struct coord
{
    int x, y;
} coord;

void barreira(int *x, int *y,int antgx,int antgy,int barra[20][30])
{
    if(barra[*x][*y]==1) *x=antgx;
    if(barra[*x][*y]==1) *x=antgx;
    if(barra[*x][*y]==1) *y=antgy;
    if(barra[*x][*y]==1) *y=antgy;
    if(*y==29) *y=0;
    else if(*y==0) *y=29;
    if(*x==0) *x=19;
    else if(*x==19) *x=0;
}

void direcao(int *x, int *y)
{
    static char c;
    if(kbhit()) c=getch();
    switch(c)
    {
    case 'w':
        *x-=1;
        break;
    case 's':
        *x+=1;
        break;
    case 'a':
        *y-=1;
        break;
    case 'd':
        *y+=1;
        break;
    }
}

void dirrand(int *x, int *y)
{
    int n;
    static int cont=0;
    cont++;
    if(cont>3) n=rand()%4;
    else n=0;
    switch(n)
    {
    case 0:
        *x-=1;
        break;
    case 1:
        *x+=1;
        break;
    case 2:
        *y-=1;
        break;
    case 3:
        *y+=1;
        break;
    }
}

void GAMEOVER(void)
{
    system("cls");
    printf("\n\n\n\n\n\t\t\tGAME OVER\n\n\n\t\tPrecione qualquer tecla...\n\n");
    getch();
    main();
}

main()
{
    int matriz[20][30];
    char c;
    int i, j, t=50,aux[4],auxy[4], ponto=0, barra[20][30];
    coord pm, fant[3];
    pm.x=18;
    pm.y=1;
    for(i=0; i<3; i++)
    {
        fant[i].x=10;
        fant[i].y=15;
    }

    for(i=0; i<20; i++)
        for(j=0; j<30; j++)
            barra[i][j]=0;

    for(i=0; i<20; i++)
    {
        for(j=0; j<30; j++)
        {

            if((i==0 || i==19))
                matriz[i][j]=219;
            else if((j==0 || j==29) && i!= 10 )
                matriz[i][j]=219;
            else  if(i==5 && j == 7)
                matriz[i][j]=219;
            else if( (i==10 && j==0) || (i==10 && j==29))
                matriz[i][j]=' ';
            else  matriz[i][j]=248;
            if(matriz[i][j]==219) barra[i][j]=1;

        }
    }
    matriz[pm.x][pm.y]=' ';

    while(1)
    {
        system("cls");

        for(i=0; i<3; i++)
        {
            auxy[i]=fant[i].y;
            aux[i]=fant[i].x;
            dirrand(&fant[i].x, &fant[i].y);
            barreira(&fant[i].x,&fant[i].y,aux[i],auxy[i],barra);
            if(fant[i].x==pm.x && fant[i].y==pm.y)
            {
                GAMEOVER();
            }
        }

        auxy[3]=pm.y;
        aux[3]=pm.x;
        direcao(&pm.x, &pm.y);
        barreira(&pm.x,&pm.y,aux[3],auxy[3],barra);



        printf("Pontuacao: %d\n", ponto);
        for(i=0; i<20; i++)
        {
            for(j=0; j<30; j++)
            {

                if( matriz[i][j]==248 && i==pm.x && j==pm.y)
                {
                    ponto++;
                    t=250;
                    matriz[i][j]=' ';
                    putchar('N');
                }
                else if( matriz[i][j]==' ' && i==pm.x && j==pm.y)
                {
                    t=0;
                    putchar('N');//Pac-Man
                }

                //if(i==pm.x&&j==pm.y) matriz[i][j]='O';
                else if(i==fant[0].x && j==fant[0].y)
                {
                    putchar(182); //fantasma
                }
                else if(i==fant[1].x && j==fant[1].y)
                {
                    putchar(182);//fantasma
                }
                else if(i==fant[2].x && j==fant[2].y)
                {
                    putchar(182);//fantasma
                }
                //else matriz[i][j]=' ';
                else printf("%c", matriz[i][j]);
            }
            putchar('\n');
        }
        for(i=0; i<3; i++)
        {
            if(fant[i].x==pm.x && fant[i].y==pm.y)
            {
                GAMEOVER();
            }
        }
        Sleep(250);
    }
}
